{% extends "base.twig" %}
{% block title %}Corpus{% endblock %}
{% block content %}
    <div class="row">
        <div class="col-md-12">
            <h2>{% if course is defined %}{{ course.name }} ({{ course.code }}){% else %}All Courses{% endif %}</h2>
        </div>
        {% if topics is defined %}
            <div class="col-md-6">
        {% else %}
            <div class="col-md-12">
        {% endif %}
            <div style="text-align: center;">
            <h3>Top {{ rows }} Words</h3>
            
            <canvas id="wordcloud" class="canvas" width="600" height="400"></canvas>
            <script>
            WordCloud(document.getElementById('wordcloud'), { 
                list: {{ corpus_words|raw }}
                // ,gridSize: 0
                // , origin: [300, 200]
            });
            </script>
        
            {# <div id="pieChartTopWords" style="text-align: center;"></div>
            <script>
            var pie = new d3pie("pieChartTopWords", {
                "header": {
                    "title": {
                        "text": "Top {{rows}} Words",
                        "fontSize": 24,
                        "font": "arial"
                    }
                    // ,
                    // "subtitle": {
                    //     "text": "Data description",
                    //     "color": "#999999",
                    //     "fontSize": 12,
                    //     "font": "open sans"
                    // },
                    // "titleSubtitlePadding": 9
                },
                "footer": {
                    "color": "#999999",
                    "fontSize": 10,
                    "font": "open sans",
                    "location": "bottom-left"
                },
                "size": {
                    "canvasWidth": 590,
                    "pieOuterRadius": "90%"
                },
                "data": {
                    "sortOrder": "value-desc",
                    "content": {{ data|raw }}
                },
                "labels": {
                    "outer": {
                        "pieDistance": 32
                    },
                    "inner": {
                        "hideWhenLessThanPercentage": 3
                    },
                    "mainLabel": {
                        "fontSize": 11
                    },
                    "percentage": {
                        "color": "#ffffff",
                        "decimalPlaces": 1
                    },
                    "value": {
                        "color": "#adadad",
                        "fontSize": 11
                    },
                    "lines": {
                        "enabled": true
                    },
                    "truncation": {
                        "enabled": true
                    }
                },
                "effects": {
                    "pullOutSegmentOnClick": {
                        "effect": "linear",
                        "speed": 400,
                        "size": 8
                    }
                },
                "misc": {
                    "gradient": {
                        "enabled": true,
                        "percentage": 100
                    }
                }
            });
            </script> #}
        </div>
            
            <h3>Summary</h3>
            <table class="table table-striped table-hover table-condensed table-bordered">
                <tr>
                    <th>Documents</th>
                    <td>{{ summary.documents }}</td>
                </tr>
                <tr>
                    <th>Words</th>
                    <td>{{ summary.words }}</td>
                </tr>
                <tr>
                    <th>Source</th>
                    <td><a href="http://courses.cs.ut.ee{% if course is defined %}{{ course.url }}{% endif %}">Homepage</a></td>
                </tr>
            </table>
        </div>
        
        {% if topics is defined %}
            <div class="col-md-6">
            <h3>Topics</h3>
            <div id="pieChartTopics"></div>
<script>
$(function () {
    $('#pieChartTopics').highcharts({
        chart: {
            plotBackgroundColor: null,
            plotBorderWidth: null,
            plotShadow: false
        },
        title: {
            text: 'Top 5 Topics for Course'
        },
        tooltip: {
            pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
        },
        plotOptions: {
            pie: {
                allowPointSelect: true,
                cursor: 'pointer',
                dataLabels: {
                    enabled: true,
                    format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                    style: {
                        color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                    }
                }
            }
        },
        series: [{
            type: 'pie',
            name: 'Topic Weight',
            data: {{ topic_weights|raw }}
                // [
                // ['Firefox',   45.0],
                // ['IE',       26.8],
                // {
                //     name: 'Chrome',
                //     y: 12.8,
                //     sliced: true,
                //     selected: true
                // },
                // ['Safari',    8.5],
                // ['Opera',     6.2],
                // ['Others',   0.7]
            // ]
        }]
    });
});
</script>
            <table class="table table-striped table-hover table-condensed table-bordered">
                <tr>
                    <th>Topic</th>
                    <th>Weight</th>
                    <th>Topic words</th>
                    
                </tr>
                {% for topic in topics %}
                <tr>
                    <td>T{{ topic.topic }}</td>
                    <td>{{ topic.weight }}%</td>
                    <td>{{ topic.words }}</td>
                </tr>
                {% endfor %}
            </table>
            {# <h3>Similar courses</h3>
        <div id="diagram" style="width:100%; height:300px;"></div>
<script>
        var topic_words = {{ topic_words|raw }};
        $(function () {
            $('#diagram').highcharts({
                chart: {
                    type: 'heatmap',
                    marginTop: 40,
                    marginBottom: 40
                },

                // title: {
                //     text: 'Course Topics'
                // },

                xAxis: {
                    categories: {{ map_topics|raw }},
                },

                yAxis: {
                    categories: {{ map_courses|raw }},
                    title: null
                },

                colorAxis: {
                    min: 0,
                    max: 100,
                    minColor: '#FFFFFF',
                    maxColor: Highcharts.getOptions().colors[3]
                },

                legend: {
                    align: 'right',
                    layout: 'vertical',
                    margin: 10,
                    verticalAlign: 'top',
                    y: 25,
                },

                tooltip: {
                    formatter: function () {
                        return '<b>' + this.series.yAxis.categories[this.point.y] + '</b> has <br><b>' +
                            this.point.value + '%</b> for topic <br><b>' + this.series.xAxis.categories[this.point.x] + ' (' + topic_words[this.point.x] + ')' + '</b>';
                    }
                },

                series: [{
                    name: 'LDA',
                    borderWidth: 0,
                    data: {{ map_data|raw }},
                    dataLabels: {
                        enabled: false,
                        color: 'black',
                        style: {
                            textShadow: 'none'
                        }
                    }
                }]

            });
        });
</script>
        </div> #}
        {% endif %}
    </div>
      
  {% endblock %}
